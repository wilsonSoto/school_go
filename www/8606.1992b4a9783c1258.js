"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8606],{8606:(W,m,u)=>{u.r(m),u.d(m,{DriverPageModule:()=>A,HttpLoaderFactory:()=>P});var a=u(7125),p=u(8834),g=u(9417),R=u(5528),h=u(467),e=u(9498),_=u(4909),k=u(3975),y=u(2167),S=u(8397),D=u(3067),C=u(7831),M=u(5690);function F(i,l){1&i&&(e.j41(0,"div",15),e.nrm(1,"ion-spinner",16),e.j41(2,"p"),e.EFF(3,"Cargando Rutas..."),e.k0s()())}function j(i,l){if(1&i){const s=e.RV6();e.j41(0,"div",17),e.nrm(1,"ion-icon",18),e.j41(2,"p"),e.EFF(3),e.k0s(),e.j41(4,"ion-button",19),e.bIt("click",function(){e.eBV(s);const o=e.XpG();return e.Njj(o.getAllRoute())}),e.EFF(5,"Reintentar"),e.k0s()()}if(2&i){const s=e.XpG();e.R7$(3),e.JRh(s.errorMessage)}}function I(i,l){1&i&&(e.j41(0,"div",20),e.nrm(1,"ion-icon",21),e.j41(2,"p"),e.EFF(3,"No hay informaci\xf3n disponible para esta secci\xf3n."),e.k0s()())}function G(i,l){if(1&i){const s=e.RV6();e.j41(0,"app-all-route",23),e.bIt("click",function(){const o=e.eBV(s).$implicit,n=e.XpG(3);return e.Njj(n.handleOpenRouteModal("edit",o))}),e.k0s()}2&i&&e.Y8G("route",l.$implicit)}function T(i,l){if(1&i&&(e.j41(0,"div"),e.DNE(1,G,1,1,"app-all-route",22),e.k0s()),2&i){const s=e.XpG(2);e.R7$(),e.Y8G("ngForOf",s.filtered_pickup)}}function $(i,l){if(1&i){const s=e.RV6();e.j41(0,"app-all-route",23),e.bIt("click",function(){const o=e.eBV(s).$implicit,n=e.XpG(3);return e.Njj(n.handleOpenRouteModal("edit",o))}),e.k0s()}2&i&&e.Y8G("route",l.$implicit)}function O(i,l){if(1&i&&(e.j41(0,"div"),e.DNE(1,$,1,1,"app-all-route",22),e.k0s()),2&i){const s=e.XpG(2);e.R7$(),e.Y8G("ngForOf",s.filtered_delivery)}}function b(i,l){if(1&i&&(e.j41(0,"div"),e.DNE(1,T,2,1,"div",13)(2,O,2,1,"div",13),e.k0s()),2&i){const s=e.XpG();e.R7$(),e.Y8G("ngIf","pickup"===s.typeSelect),e.R7$(),e.Y8G("ngIf","delivery"===s.typeSelect)}}function L(i,l){if(1&i){const s=e.RV6();e.j41(0,"ion-content")(1,"ion-list")(2,"ion-item",24),e.bIt("click",function(){e.eBV(s);const o=e.XpG();return e.Njj(o.logoutAndGoToSignIn())}),e.EFF(3,"Cerrar Sesi\xf3n"),e.k0s()()()}2&i&&(e.R7$(2),e.Y8G("button",!0)("detail",!1))}const x=[{path:"",component:(()=>{var i;class l{constructor(t,o,n,r,d,c,v){this.translate=t,this.router=o,this.routeService=n,this.toastService=r,this.authService=d,this.parentService=c,this.modalController=v,this.typeSelect="pickup",this.hasData=!0,this.isSelectInfo=!0,this.userData="",this.students=[],this.school_routes_pickup=[],this.school_routes_delivery=[],this.isLoading=!0,this.errorMessage=null,this.searchTerm="",this.filtered_pickup=[],this.filtered_delivery=[]}logoutAndGoToSignIn(){var t=this;return(0,h.A)(function*(){yield t.authService.logout(),t.router.navigate(["/sign-in"])})()}changeLanguage(t){this.translate.use(t="es"==t?"en":"es")}ngOnInit(){var t;const o=this.router.url;console.log(this.userData,"[[[initttttttttttttttttttttttttttttttttttttttttttttttttt]]]"),null!==(t=this.userData)&&void 0!==t&&t.partner_id&&"/sign-in"!==o&&"/"!==o&&this.getParent()}ionViewWillEnter(){var t=this;return(0,h.A)(function*(){var o,n;t.userData=yield null===(o=JSON.parse(localStorage.getItem("userData")||"null"))||void 0===o?void 0:o.userInfo;const r=t.router.url;console.log(t.userData,"[[[userrrrrrrrrrrrrrrrr]]]"),null!==(n=t.userData)&&void 0!==n&&n.partner_id&&"/sign-in"!==r&&"/"!==r&&(console.log(t.userData,"[[[000000000000000000000000000000000000]]]"),t.getParent()),t.getAllRoute()})()}handleSegmentChange(t){const o=t.detail.value;this.typeSelect=o,console.log(o),"pickup"===o?(this.hasData=this.school_routes_pickup.length>0,this.isSelectInfo=!0):(this.hasData=this.school_routes_delivery.length>0,this.isSelectInfo=!1)}handleRefresh(t){this.getAllRoute(),setTimeout(()=>{t.target.complete()},2e3)}filterRoutes(t){const o=(t.target.value||"").toLowerCase();if(this.searchTerm=o,!o)return this.filtered_pickup=[...this.school_routes_pickup],this.filtered_delivery=[...this.school_routes_delivery],void(this.hasData="pickup"===this.typeSelect?this.filtered_pickup.length>0:this.filtered_delivery.length>0);const n=r=>{var d,c;const v=(null===(d=r.name)||void 0===d?void 0:d.toLowerCase())||"",B=(null===(c=r.school_driver)||void 0===c||null===(c=c.name)||void 0===c?void 0:c.toLowerCase())||"",U=(r.students||[]).map(V=>{var f;return(null===(f=V.name)||void 0===f?void 0:f.toLowerCase())||""}).join(" ");return v.includes(o)||B.includes(o)||U.includes(o)};this.filtered_pickup=this.school_routes_pickup.filter(n),this.filtered_delivery=this.school_routes_delivery.filter(n),this.hasData="pickup"===this.typeSelect?this.filtered_pickup.length>0:this.filtered_delivery.length>0}getAllRoute(){this.isLoading=!0,this.errorMessage=null,this.routeService.getAllroute().subscribe({next:t=>{this.isLoading=!1,this.school_routes_pickup=t.data.school_routes.filter(o=>"Recogida"===o.route_type),this.school_routes_delivery=t.data.school_routes.filter(o=>"Recogida"!==o.route_type),this.filtered_pickup=[...this.school_routes_pickup],this.filtered_delivery=[...this.school_routes_delivery],this.hasData="pickup"===this.typeSelect?this.school_routes_pickup.length>0:this.school_routes_delivery.length>0},error:t=>{var o,n;this.isLoading=!1;const r=(null==t||null===(o=t.error)||void 0===o||null===(o=o.error)||void 0===o?void 0:o.message)||(null==t||null===(n=t.error)||void 0===n?void 0:n.error)||(null==t?void 0:t.message)||"Error desconocido";this.errorMessage="Error al cargar las rutas: "+(r||"Error desconocido"),this.toastService.presentToast(this.errorMessage)}})}delay(t){return(0,h.A)(function*(){return new Promise(o=>setTimeout(o,t))})()}getParent(){var t,n,o=this;this.parentService.getParent(null===(t=this.userData)||void 0===t?void 0:t.partner_id).subscribe({next:(n=(0,h.A)(function*(r){const d=r.data.students.filter(c=>!c.home_latitude||!c.home_longitude||0===c.home_latitude||0===c.home_longitude);d&&d.length>0?(localStorage.setItem("studentsWithoutLocation",JSON.stringify(d)),o.toastService.presentToast("Algunos estudiantes no tienen ubicaci\xf3n"),o.router.navigateByUrl("/pending-location",{replaceUrl:!0})):localStorage.removeItem("studentsWithoutLocation")}),function(d){return n.apply(this,arguments)}),error:n=>{var r,d;const c=(null==n||null===(r=n.error)||void 0===r||null===(r=r.error)||void 0===r?void 0:r.message)||(null==n||null===(d=n.error)||void 0===d?void 0:d.error)||(null==n?void 0:n.message)||"Error desconocido";this.toastService.presentToast(c)}})}handleOpenRouteModal(t,o){o.id||console.log("error id route"),this.router.navigate([`/planned-route/${o.id}`],{queryParams:{action:t}})}}return(i=l).\u0275fac=function(t){return new(t||i)(e.rXU(_.c$),e.rXU(k.t),e.rXU(y.v),e.rXU(S.f),e.rXU(D.u),e.rXU(C.C),e.rXU(a.W3))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-route-page"]],standalone:!1,decls:26,vars:7,consts:[["mode","md"],["slot","end"],["id","driver-bus"],["src","https://ionicframework.com/docs/img/demos/avatar.svg","alt","Avatar"],["mode","ios","show-clear-button","always","clear-icon","trash-bin","placeholder","Buscar por ruta, chofer o estudiante",3,"ionInput"],["mode","ios",3,"ngModelChange","ionChange","ngModel"],["value","pickup"],["value","delivery"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["class","loading-state ion-text-center",4,"ngIf"],["class","error-state ion-text-center",4,"ngIf"],["class","empty-state ion-text-center",4,"ngIf"],[4,"ngIf"],["trigger","driver-bus",3,"dismissOnSelect"],[1,"loading-state","ion-text-center"],["name","circles"],[1,"error-state","ion-text-center"],["name","warning-outline","color","danger"],[3,"click"],[1,"empty-state","ion-text-center"],["name","information-circle-outline","color","medium"],[3,"route","click",4,"ngFor","ngForOf"],[3,"click","route"],[3,"click","button","detail"]],template:function(t,o){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e.EFF(3,"Rutas programadas"),e.k0s(),e.j41(4,"ion-buttons",1)(5,"ion-avatar",2),e.nrm(6,"img",3),e.k0s()()(),e.j41(7,"ion-toolbar")(8,"ion-searchbar",4),e.bIt("ionInput",function(r){return o.filterRoutes(r)}),e.k0s()(),e.j41(9,"ion-toolbar")(10,"ion-segment",5),e.mxI("ngModelChange",function(r){return e.DH7(o.typeSelect,r)||(o.typeSelect=r),r}),e.bIt("ionChange",function(r){return o.handleSegmentChange(r)}),e.j41(11,"ion-segment-button",6)(12,"ion-label"),e.EFF(13,"Recogida"),e.k0s()(),e.j41(14,"ion-segment-button",7)(15,"ion-label"),e.EFF(16,"Entrega"),e.k0s()()()()(),e.j41(17,"ion-content",8)(18,"ion-refresher",9),e.bIt("ionRefresh",function(r){return o.handleRefresh(r)}),e.nrm(19,"ion-refresher-content"),e.k0s(),e.DNE(20,F,4,0,"div",10)(21,j,6,1,"div",11)(22,I,4,0,"div",12)(23,b,3,2,"div",13),e.k0s(),e.j41(24,"ion-popover",14),e.DNE(25,L,4,2,"ng-template"),e.k0s()),2&t&&(e.R7$(10),e.R50("ngModel",o.typeSelect),e.R7$(7),e.Y8G("fullscreen",!0),e.R7$(3),e.Y8G("ngIf",o.isLoading),e.R7$(),e.Y8G("ngIf",o.errorMessage),e.R7$(),e.Y8G("ngIf",!o.isLoading&&!o.hasData),e.R7$(),e.Y8G("ngIf",!o.isLoading&&o.hasData),e.R7$(),e.Y8G("dismissOnSelect",!0))},dependencies:[a.mC,a.Jm,a.QW,a.W9,a.eU,a.iq,a.uz,a.he,a.nf,a.To,a.Ki,a.S1,a.Gp,a.eP,a.w2,a.BC,a.ai,a.CF,a.Je,a.Gw,p.G,p.I,g.BC,g.vS,M.E],styles:['@charset "UTF-8";ion-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{margin:0 5px}ion-header[_ngcontent-%COMP%] > ion-toolbar[_ngcontent-%COMP%]:nth-of-type(3){--padding-start: 0;--padding-end: 0}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{width:100%;--margin-start: 0;--margin-end: 0}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{flex:1 1 0;max-width:100%}']}),l})()}];let E=(()=>{var i;class l{}return(i=l).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[R.m.forChild(x),R.m]}),l})();var N=u(5218),X=u(8041),Y=u(1150);function P(i){return new N.s(i,"./assets/translate/",".json")}let A=(()=>{var i;class l{}return(i=l).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({providers:[y.v],imports:[a.bv,p.D,g.YN,E,g.X1,_.h.forRoot({defaultLanguage:"es",loader:{provide:_.Wr,useFactory:P,deps:[X.a]}}),Y.G]}),l})()}}]);