"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8606],{8606:(V,m,l)=>{l.r(m),l.d(m,{DriverPageModule:()=>Y,HttpLoaderFactory:()=>P});var s=l(7125),h=l(8834),g=l(9417),f=l(5528),R=l(467),e=l(9498),v=l(4909),D=l(3975),y=l(2167),F=l(8397),S=l(3067),j=l(7831),k=l(5690);function $(i,u){1&i&&(e.j41(0,"div",19),e.nrm(1,"ion-spinner",20),e.j41(2,"p"),e.EFF(3,"Cargando Rutas..."),e.k0s()())}function C(i,u){if(1&i){const a=e.RV6();e.j41(0,"div",21),e.nrm(1,"ion-icon",22),e.j41(2,"p"),e.EFF(3),e.k0s(),e.j41(4,"ion-button",23),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.getAllRoute())}),e.EFF(5,"Reintentar"),e.k0s()()}if(2&i){const a=e.XpG();e.R7$(3),e.JRh(a.errorMessage)}}function I(i,u){1&i&&(e.j41(0,"div",24),e.nrm(1,"ion-icon",25),e.j41(2,"p"),e.EFF(3,"No hay informaci\xf3n disponible para esta secci\xf3n."),e.k0s()())}function M(i,u){if(1&i){const a=e.RV6();e.j41(0,"app-all-route",29),e.bIt("click",function(){const t=e.eBV(a).$implicit,r=e.XpG(2);return e.Njj(r.handleOpenRouteModal("edit",t))}),e.k0s()}2&i&&e.Y8G("route",u.$implicit)}function G(i,u){if(1&i){const a=e.RV6();e.j41(0,"app-all-route",29),e.bIt("click",function(){const t=e.eBV(a).$implicit,r=e.XpG(2);return e.Njj(r.handleOpenRouteModal("edit",t))}),e.k0s()}2&i&&e.Y8G("route",u.$implicit)}function T(i,u){if(1&i&&(e.j41(0,"ion-segment-view")(1,"ion-segment-content",26),e.DNE(2,M,1,1,"app-all-route",27),e.k0s(),e.j41(3,"ion-segment-content",28),e.DNE(4,G,1,1,"app-all-route",27),e.k0s()()),2&i){const a=e.XpG();e.R7$(2),e.Y8G("ngForOf",a.filtered_pickup),e.R7$(2),e.Y8G("ngForOf",a.filtered_delivery)}}function L(i,u){if(1&i){const a=e.RV6();e.j41(0,"ion-content")(1,"ion-list")(2,"ion-item",30),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.logoutAndGoToSignIn())}),e.EFF(3,"Cerrar Sesi\xf3n"),e.k0s()()()}2&i&&(e.R7$(2),e.Y8G("button",!0)("detail",!1))}const E=[{path:"",component:(()=>{var i;class u{constructor(o,t,r,n,d,c,p){this.translate=o,this.router=t,this.routeService=r,this.toastService=n,this.authService=d,this.parentService=c,this.modalController=p,this.typeSelect="first",this.hasData=!0,this.userData="",this.students=[],this.school_routes_pickup=[],this.school_routes_delivery=[],this.isLoading=!0,this.errorMessage=null,this.searchTerm="",this.filtered_pickup=[],this.filtered_delivery=[]}logoutAndGoToSignIn(){var o=this;return(0,R.A)(function*(){yield o.authService.logout(),o.router.navigate(["/sign-in"])})()}changeLanguage(o){this.translate.use(o="es"==o?"en":"es")}ngOnInit(){var o;const t=this.router.url;null!==(o=this.userData)&&void 0!==o&&o.partner_id&&"/sign-in"!==t&&"/"!==t&&this.getParent()}ionViewWillEnter(){var o=this;return(0,R.A)(function*(){var t,r;o.userData=yield null===(t=JSON.parse(localStorage.getItem("userData")||"null"))||void 0===t?void 0:t.userInfo;const n=o.router.url;console.log(o.userData,"[[[userrrrrrrrrrrrrrrrr]]]"),null!==(r=o.userData)&&void 0!==r&&r.partner_id&&"/sign-in"!==n&&"/"!==n&&(console.log(o.userData,"[[[000000000000000000000000000000000000]]]"),o.getParent()),o.getAllRoute()})()}handleSegmentChange(o){const t=o.detail.value;this.typeSelect=t,this.hasData="first"===t?this.school_routes_pickup.length>0:this.school_routes_delivery.length>0}handleRefresh(o){this.getAllRoute(),setTimeout(()=>{o.target.complete()},2e3)}filterRoutes(o){const t=(o.target.value||"").toLowerCase();if(this.searchTerm=t,!t)return this.filtered_pickup=[...this.school_routes_pickup],this.filtered_delivery=[...this.school_routes_delivery],void(this.hasData="first"===this.typeSelect?this.filtered_pickup.length>0:this.filtered_delivery.length>0);const r=n=>{var d,c;const p=(null===(d=n.name)||void 0===d?void 0:d.toLowerCase())||"",x=(null===(c=n.school_driver)||void 0===c||null===(c=c.name)||void 0===c?void 0:c.toLowerCase())||"",B=(n.students||[]).map(U=>{var _;return(null===(_=U.name)||void 0===_?void 0:_.toLowerCase())||""}).join(" ");return p.includes(t)||x.includes(t)||B.includes(t)};this.filtered_pickup=this.school_routes_pickup.filter(r),this.filtered_delivery=this.school_routes_delivery.filter(r),this.hasData="first"===this.typeSelect?this.filtered_pickup.length>0:this.filtered_delivery.length>0}getAllRoute(){this.isLoading=!0,this.errorMessage=null,this.routeService.getAllroute().subscribe({next:o=>{this.isLoading=!1,this.school_routes_pickup=o.data.school_routes.filter(t=>"Recogida"===t.route_type),this.school_routes_delivery=o.data.school_routes.filter(t=>"Recogida"!==t.route_type),this.filtered_pickup=[...this.school_routes_pickup],this.filtered_delivery=[...this.school_routes_delivery],this.hasData="first"===this.typeSelect?this.school_routes_pickup.length>0:this.school_routes_delivery.length>0},error:o=>{var t,r;this.isLoading=!1;const n=(null==o||null===(t=o.error)||void 0===t||null===(t=t.error)||void 0===t?void 0:t.message)||(null==o||null===(r=o.error)||void 0===r?void 0:r.error)||(null==o?void 0:o.message)||"Error desconocido";this.errorMessage="Error al cargar las rutas: "+(n||"Error desconocido"),this.toastService.presentToast(this.errorMessage)}})}getParent(){var o;this.parentService.getParent(null===(o=this.userData)||void 0===o?void 0:o.partner_id).subscribe({next:t=>{const r=t.data.students.filter(n=>!n.home_latitude||!n.home_longitude||0===n.home_latitude||0===n.home_longitude);r&&r.length>0&&(localStorage.setItem("studentsWithoutLocation",JSON.stringify(r)),this.router.navigateByUrl("/pending-location",{replaceUrl:!0}))},error:t=>{var r,n;const d=(null==t||null===(r=t.error)||void 0===r||null===(r=r.error)||void 0===r?void 0:r.message)||(null==t||null===(n=t.error)||void 0===n?void 0:n.error)||(null==t?void 0:t.message)||"Error desconocido";this.toastService.presentToast(d)}})}handleOpenRouteModal(o,t){t.id||console.log("error id route"),this.router.navigate([`/planned-route/${t.id}`],{queryParams:{action:o}})}}return(i=u).\u0275fac=function(o){return new(o||i)(e.rXU(v.c$),e.rXU(D.t),e.rXU(y.v),e.rXU(F.f),e.rXU(S.u),e.rXU(j.C),e.rXU(s.W3))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-route-page"]],standalone:!1,decls:29,vars:7,consts:[[1,"i-header"],[1,"i-toolbar-inner"],[1,"i-toolbar"],["size","large"],["size","auto"],["id","driver-bus-button"],["alt","Silhouette of a person's head","src","https://ionicframework.com/docs/img/demos/avatar.svg"],[1,"segment"],["size","mediun","mode","ios","show-clear-button","always","clear-icon","trash-bin","placeholder","Buscar por ruta, chofer o estudiante",3,"ionInput"],["size","large","mode","ios",3,"ngModelChange","ionChange","ngModel"],["value","first","content-id","first"],["value","second","content-id","second"],[1,"",3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["class","loading-state ion-text-center",4,"ngIf"],["class","error-state ion-text-center",4,"ngIf"],["class","empty-state ion-text-center",4,"ngIf"],[4,"ngIf"],["trigger","driver-bus-button",3,"dismissOnSelect"],[1,"loading-state","ion-text-center"],["name","circles"],[1,"error-state","ion-text-center"],["name","warning-outline","color","danger"],[3,"click"],[1,"empty-state","ion-text-center"],["name","information-circle-outline","color","medium"],["id","first"],[3,"route","click",4,"ngFor","ngForOf"],["id","second"],[3,"click","route"],[3,"click","button","detail"]],template:function(o,t){1&o&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"div",1)(3,"ion-row",2)(4,"ion-col")(5,"ion-title",3),e.EFF(6,"Rutas programadas "),e.k0s()(),e.j41(7,"ion-col",4)(8,"div")(9,"ion-avatar",5),e.nrm(10,"img",6),e.k0s()()()()(),e.j41(11,"div",7)(12,"ion-searchbar",8),e.bIt("ionInput",function(n){return t.filterRoutes(n)}),e.k0s(),e.j41(13,"ion-segment",9),e.mxI("ngModelChange",function(n){return e.DH7(t.typeSelect,n)||(t.typeSelect=n),n}),e.bIt("ionChange",function(n){return t.handleSegmentChange(n)}),e.j41(14,"ion-segment-button",10)(15,"ion-label"),e.EFF(16,"Recogida "),e.k0s()(),e.j41(17,"ion-segment-button",11)(18,"ion-label"),e.EFF(19,"Entrega"),e.k0s()()()()()(),e.j41(20,"ion-content",12)(21,"ion-refresher",13),e.bIt("ionRefresh",function(n){return t.handleRefresh(n)}),e.nrm(22,"ion-refresher-content"),e.k0s(),e.DNE(23,$,4,0,"div",14)(24,C,6,1,"div",15)(25,I,4,0,"div",16)(26,T,5,2,"ion-segment-view",17),e.k0s(),e.j41(27,"ion-popover",18),e.DNE(28,L,4,2,"ng-template"),e.k0s()),2&o&&(e.R7$(13),e.R50("ngModel",t.typeSelect),e.R7$(7),e.Y8G("fullscreen",!0),e.R7$(3),e.Y8G("ngIf",t.isLoading),e.R7$(),e.Y8G("ngIf",t.errorMessage),e.R7$(),e.Y8G("ngIf",!t.isLoading&&!t.hasData),e.R7$(),e.Y8G("ngIf",!t.isLoading&&t.hasData),e.R7$(),e.Y8G("dismissOnSelect",!0))},dependencies:[s.mC,s.Jm,s.hU,s.W9,s.eU,s.iq,s.uz,s.he,s.nf,s.To,s.Ki,s.ln,s.S1,s.Gp,s.eP,s.Z$,s.pf,s.w2,s.BC,s.ai,s.CF,s.Je,s.Gw,h.G,h.I,g.BC,g.vS,k.E],styles:["ion-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{margin:0 5px}"]}),u})()}];let b=(()=>{var i;class u{}return(i=u).\u0275fac=function(o){return new(o||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[f.m.forChild(E),f.m]}),u})();var N=l(5218),X=l(8041),O=l(1150);function P(i){return new N.s(i,"./assets/translate/",".json")}let Y=(()=>{var i;class u{}return(i=u).\u0275fac=function(o){return new(o||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({providers:[y.v],imports:[s.bv,h.D,g.YN,b,g.X1,v.h.forRoot({defaultLanguage:"es",loader:{provide:v.Wr,useFactory:P,deps:[X.a]}}),O.G]}),u})()}}]);