"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8606],{8606:(J,f,u)=>{u.r(f),u.d(f,{DriverPageModule:()=>B,HttpLoaderFactory:()=>k});var a=u(7125),g=u(8834),h=u(9417),m=u(5528),R=u(467),e=u(9498),p=u(4909),P=u(3975),y=u(2167),S=u(8397),D=u(3067),j=u(7831),F=u(5690);function I(i,l){1&i&&(e.j41(0,"div",19),e.nrm(1,"ion-spinner",20),e.j41(2,"p"),e.EFF(3,"Cargando Rutas..."),e.k0s()())}function G(i,l){if(1&i){const s=e.RV6();e.j41(0,"div",21),e.nrm(1,"ion-icon",22),e.j41(2,"p"),e.EFF(3),e.k0s(),e.j41(4,"ion-button",23),e.bIt("click",function(){e.eBV(s);const t=e.XpG();return e.Njj(t.getAllRoute())}),e.EFF(5,"Reintentar"),e.k0s()()}if(2&i){const s=e.XpG();e.R7$(3),e.JRh(s.errorMessage)}}function $(i,l){1&i&&(e.j41(0,"div",24),e.nrm(1,"ion-icon",25),e.j41(2,"p"),e.EFF(3,"No hay informaci\xf3n disponible para esta secci\xf3n."),e.k0s()())}function C(i,l){if(1&i){const s=e.RV6();e.j41(0,"app-all-route",27),e.bIt("click",function(){const t=e.eBV(s).$implicit,r=e.XpG(3);return e.Njj(r.handleOpenRouteModal("edit",t))}),e.k0s()}2&i&&e.Y8G("route",l.$implicit)}function M(i,l){if(1&i&&(e.j41(0,"div"),e.DNE(1,C,1,1,"app-all-route",26),e.k0s()),2&i){const s=e.XpG(2);e.R7$(),e.Y8G("ngForOf",s.filtered_pickup)}}function T(i,l){if(1&i){const s=e.RV6();e.j41(0,"app-all-route",27),e.bIt("click",function(){const t=e.eBV(s).$implicit,r=e.XpG(3);return e.Njj(r.handleOpenRouteModal("edit",t))}),e.k0s()}2&i&&e.Y8G("route",l.$implicit)}function L(i,l){if(1&i&&(e.j41(0,"div"),e.DNE(1,T,1,1,"app-all-route",26),e.k0s()),2&i){const s=e.XpG(2);e.R7$(),e.Y8G("ngForOf",s.filtered_delivery)}}function E(i,l){if(1&i&&(e.j41(0,"div"),e.DNE(1,M,2,1,"div",17)(2,L,2,1,"div",17),e.k0s()),2&i){const s=e.XpG();e.R7$(),e.Y8G("ngIf","pickup"===s.typeSelect),e.R7$(),e.Y8G("ngIf","delivery"===s.typeSelect)}}function N(i,l){if(1&i){const s=e.RV6();e.j41(0,"ion-content")(1,"ion-list")(2,"ion-item",28),e.bIt("click",function(){e.eBV(s);const t=e.XpG();return e.Njj(t.logoutAndGoToSignIn())}),e.EFF(3,"Cerrar Sesi\xf3n"),e.k0s()()()}2&i&&(e.R7$(2),e.Y8G("button",!0)("detail",!1))}const X=[{path:"",component:(()=>{var i;class l{constructor(o,t,r,n,d,c,v){this.translate=o,this.router=t,this.routeService=r,this.toastService=n,this.authService=d,this.parentService=c,this.modalController=v,this.typeSelect="pickup",this.hasData=!0,this.isSelectInfo=!0,this.userData="",this.students=[],this.school_routes_pickup=[],this.school_routes_delivery=[],this.isLoading=!0,this.errorMessage=null,this.searchTerm="",this.filtered_pickup=[],this.filtered_delivery=[]}logoutAndGoToSignIn(){var o=this;return(0,R.A)(function*(){yield o.authService.logout(),o.router.navigate(["/sign-in"])})()}changeLanguage(o){this.translate.use(o="es"==o?"en":"es")}ngOnInit(){var o;const t=this.router.url;null!==(o=this.userData)&&void 0!==o&&o.partner_id&&"/sign-in"!==t&&"/"!==t&&this.getParent()}ionViewWillEnter(){var o=this;return(0,R.A)(function*(){var t,r;o.userData=yield null===(t=JSON.parse(localStorage.getItem("userData")||"null"))||void 0===t?void 0:t.userInfo;const n=o.router.url;console.log(o.userData,"[[[userrrrrrrrrrrrrrrrr]]]"),null!==(r=o.userData)&&void 0!==r&&r.partner_id&&"/sign-in"!==n&&"/"!==n&&(console.log(o.userData,"[[[000000000000000000000000000000000000]]]"),o.getParent()),o.getAllRoute()})()}handleSegmentChange(o){const t=o.detail.value;this.typeSelect=t,console.log(t),"pickup"===t?(this.hasData=this.school_routes_pickup.length>0,this.isSelectInfo=!0):(this.hasData=this.school_routes_delivery.length>0,this.isSelectInfo=!1)}handleRefresh(o){this.getAllRoute(),setTimeout(()=>{o.target.complete()},2e3)}filterRoutes(o){const t=(o.target.value||"").toLowerCase();if(this.searchTerm=t,!t)return this.filtered_pickup=[...this.school_routes_pickup],this.filtered_delivery=[...this.school_routes_delivery],void(this.hasData="pickup"===this.typeSelect?this.filtered_pickup.length>0:this.filtered_delivery.length>0);const r=n=>{var d,c;const v=(null===(d=n.name)||void 0===d?void 0:d.toLowerCase())||"",U=(null===(c=n.school_driver)||void 0===c||null===(c=c.name)||void 0===c?void 0:c.toLowerCase())||"",V=(n.students||[]).map(A=>{var _;return(null===(_=A.name)||void 0===_?void 0:_.toLowerCase())||""}).join(" ");return v.includes(t)||U.includes(t)||V.includes(t)};this.filtered_pickup=this.school_routes_pickup.filter(r),this.filtered_delivery=this.school_routes_delivery.filter(r),this.hasData="pickup"===this.typeSelect?this.filtered_pickup.length>0:this.filtered_delivery.length>0}getAllRoute(){this.isLoading=!0,this.errorMessage=null,this.routeService.getAllroute().subscribe({next:o=>{this.isLoading=!1,this.school_routes_pickup=o.data.school_routes.filter(t=>"Recogida"===t.route_type),this.school_routes_delivery=o.data.school_routes.filter(t=>"Recogida"!==t.route_type),this.filtered_pickup=[...this.school_routes_pickup],this.filtered_delivery=[...this.school_routes_delivery],this.hasData="pickup"===this.typeSelect?this.school_routes_pickup.length>0:this.school_routes_delivery.length>0},error:o=>{var t,r;this.isLoading=!1;const n=(null==o||null===(t=o.error)||void 0===t||null===(t=t.error)||void 0===t?void 0:t.message)||(null==o||null===(r=o.error)||void 0===r?void 0:r.error)||(null==o?void 0:o.message)||"Error desconocido";this.errorMessage="Error al cargar las rutas: "+(n||"Error desconocido"),this.toastService.presentToast(this.errorMessage)}})}getParent(){var o;this.parentService.getParent(null===(o=this.userData)||void 0===o?void 0:o.partner_id).subscribe({next:t=>{const r=t.data.students.filter(n=>!n.home_latitude||!n.home_longitude||0===n.home_latitude||0===n.home_longitude);r&&r.length>0&&(localStorage.setItem("studentsWithoutLocation",JSON.stringify(r)),this.router.navigateByUrl("/pending-location",{replaceUrl:!0}))},error:t=>{var r,n;const d=(null==t||null===(r=t.error)||void 0===r||null===(r=r.error)||void 0===r?void 0:r.message)||(null==t||null===(n=t.error)||void 0===n?void 0:n.error)||(null==t?void 0:t.message)||"Error desconocido";this.toastService.presentToast(d)}})}handleOpenRouteModal(o,t){t.id||console.log("error id route"),this.router.navigate([`/planned-route/${t.id}`],{queryParams:{action:o}})}}return(i=l).\u0275fac=function(o){return new(o||i)(e.rXU(p.c$),e.rXU(P.t),e.rXU(y.v),e.rXU(S.f),e.rXU(D.u),e.rXU(j.C),e.rXU(a.W3))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-route-page"]],standalone:!1,decls:29,vars:7,consts:[[1,"i-header"],[1,"i-toolbar-inner"],[1,"i-toolbar"],["size","large"],["size","auto"],["id","driver-bus"],["alt","Silhouette of a person's head","src","https://ionicframework.com/docs/img/demos/avatar.svg"],[1,"segment"],["size","mediun","mode","ios","show-clear-button","always","clear-icon","trash-bin","placeholder","Buscar por ruta, chofer o estudiante",3,"ionInput"],["size","large","mode","ios",3,"ngModelChange","ionChange","ngModel"],["value","pickup","content-id","pickup"],["value","delivery","content-id","delivery"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["class","loading-state ion-text-center",4,"ngIf"],["class","error-state ion-text-center",4,"ngIf"],["class","empty-state ion-text-center",4,"ngIf"],[4,"ngIf"],["trigger","driver-bus",3,"dismissOnSelect"],[1,"loading-state","ion-text-center"],["name","circles"],[1,"error-state","ion-text-center"],["name","warning-outline","color","danger"],[3,"click"],[1,"empty-state","ion-text-center"],["name","information-circle-outline","color","medium"],[3,"route","click",4,"ngFor","ngForOf"],[3,"click","route"],[3,"click","button","detail"]],template:function(o,t){1&o&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"div",1)(3,"ion-row",2)(4,"ion-col")(5,"ion-title",3),e.EFF(6,"Rutas programadas "),e.k0s()(),e.j41(7,"ion-col",4)(8,"div")(9,"ion-avatar",5),e.nrm(10,"img",6),e.k0s()()()()(),e.j41(11,"div",7)(12,"ion-searchbar",8),e.bIt("ionInput",function(n){return t.filterRoutes(n)}),e.k0s(),e.j41(13,"ion-segment",9),e.mxI("ngModelChange",function(n){return e.DH7(t.typeSelect,n)||(t.typeSelect=n),n}),e.bIt("ionChange",function(n){return t.handleSegmentChange(n)}),e.j41(14,"ion-segment-button",10)(15,"ion-label"),e.EFF(16,"Recogida"),e.k0s()(),e.j41(17,"ion-segment-button",11)(18,"ion-label"),e.EFF(19,"Entrega"),e.k0s()()()()()(),e.j41(20,"ion-content",12)(21,"ion-refresher",13),e.bIt("ionRefresh",function(n){return t.handleRefresh(n)}),e.nrm(22,"ion-refresher-content"),e.k0s(),e.DNE(23,I,4,0,"div",14)(24,G,6,1,"div",15)(25,$,4,0,"div",16)(26,E,3,2,"div",17),e.k0s(),e.j41(27,"ion-popover",18),e.DNE(28,N,4,2,"ng-template"),e.k0s()),2&o&&(e.R7$(13),e.R50("ngModel",t.typeSelect),e.R7$(7),e.Y8G("fullscreen",!0),e.R7$(3),e.Y8G("ngIf",t.isLoading),e.R7$(),e.Y8G("ngIf",t.errorMessage),e.R7$(),e.Y8G("ngIf",!t.isLoading&&!t.hasData),e.R7$(),e.Y8G("ngIf",!t.isLoading&&t.hasData),e.R7$(),e.Y8G("dismissOnSelect",!0))},dependencies:[a.mC,a.Jm,a.hU,a.W9,a.eU,a.iq,a.uz,a.he,a.nf,a.To,a.Ki,a.ln,a.S1,a.Gp,a.eP,a.w2,a.BC,a.ai,a.CF,a.Je,a.Gw,g.G,g.I,h.BC,h.vS,F.E],styles:["ion-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{margin:0 5px}"]}),l})()}];let b=(()=>{var i;class l{}return(i=l).\u0275fac=function(o){return new(o||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[m.m.forChild(X),m.m]}),l})();var x=u(5218),Y=u(8041),O=u(1150);function k(i){return new x.s(i,"./assets/translate/",".json")}let B=(()=>{var i;class l{}return(i=l).\u0275fac=function(o){return new(o||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({providers:[y.v],imports:[a.bv,g.D,h.YN,b,h.X1,p.h.forRoot({defaultLanguage:"es",loader:{provide:p.Wr,useFactory:k,deps:[Y.a]}}),O.G]}),l})()}}]);