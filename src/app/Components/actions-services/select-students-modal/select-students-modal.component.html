<ion-header class="i-header">
  <ion-toolbar>
    <div class="i-toolbar-inner">
      <ion-row class="i-toolbar">
        <ion-col>
          <ion-title size="large">Seleccione Estudiantes</ion-title>
        </ion-col>
      </ion-row>
    </div>
    <ion-buttons slot="end">
      <ion-button (click)="dismissModal('cancel')">Cerrar</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div *ngIf="isLoading" class="loading-state ion-text-center">
    <ion-spinner name="circles"></ion-spinner>
    <p>Cargando estudiantes...</p>
  </div>

  <div *ngIf="errorMessage" class="error-state ion-text-center">
    <ion-icon name="warning-outline" color="danger"></ion-icon>
    <p>{{ errorMessage }}</p>
    <ion-button (click)="loadStudents()">Reintentar</ion-button>
  </div>

  <form [formGroup]="studentsForm" *ngIf="!isLoading && !errorMessage">
    <ion-list>
      <ion-list-header>
        <ion-label>Estudiantes Disponibles</ion-label>
      </ion-list-header>

      <ion-item *ngIf="availableStudents.length === 0">
        <ion-label color="medium">No hay estudiantes disponibles.</ion-label>
      </ion-item>

      <ion-item *ngFor="let student of availableStudents">
        <ion-checkbox
          labelPlacement="end"
          [checked]="isStudentSelected(student.id)"
          (ionChange)="onStudentCheckboxChange($event, student)"
        >
        <ion-item>
        <ion-avatar>
        <img alt="Bus Image" [src]="student.image || 'https://ionicframework.com/docs/img/demos/bus.png'" />
      </ion-avatar>
      <span>
        <ion-card-title>
                     {{ student.name }}
                     <!-- {{ student.last_name }} (ID: {{ student.id }}) -->

          <!-- {{ selectedBus.name }} -->

        </ion-card-title>
        <!-- <ion-card-subtitle>{{ selectedBus.brand || 'Marca no especificada'}} - {{ selectedBus.model || 'Modelo no especificado'}}</ion-card-subtitle> -->
      </span>
        </ion-item>
        </ion-checkbox>
      </ion-item>
    </ion-list>
  </form>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-buttons slot="end">
      <ion-button (click)="onSelect()">
        Seleccionar ({{ selectedStudentsFormArray.length }})
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
